= S3

Cache tiles as objects in an AWS S3 bucket.

Ensure the user you're using has proper permissions for reading and writing objects in the bucket.  The permissions required are the minimal set you'd expect: GetObject and PutObject.  It's highly recommended to also grant ListBucket permissions, otherwise the log will contain misleading 403 error messages for every cache miss.  Also ensure the user has access to the KMS key if using bucket encryption.

If you're using a Directory Bucket AKA Express One Zone there's a few things to configure:

* Ensure `storageclass` is set to "EXPRESS_ONEZONE"
* The bucket contains the full name including suffix. For example: `+my-tilegroxy-cache--use1-az6--x-s3+`
* An endpoint is configured in the format "https://s3express-\{az_id}.\{region}.amazonaws.com" For example: "https://s3express-use1-az6.us-east-1.amazonaws.com"

Name should be "s3"

Configuration options:

|===
| Parameter | Type | Required | Default | Description

| bucket
| string
| Yes
| None
| The name of the bucket to use

| path
| string
| No
| /
| The path prefix to use for storing tiles

| region
| string
| No
| None
| The AWS region containing the bucket. Required if region is not specified via other means. Consult https://docs.aws.amazon.com/general/latest/gr/rande.html#regional-endpoints[AWS documentation] for possible values

| access
| string
| No
| None
| The AWS Access Key ID to authenticate with. This is not recommended; it is offered as a fallback authentication method only. Consult https://docs.aws.amazon.com/cli/v1/userguide/cli-chap-authentication.html[AWS documentation] for better options

| secret
| string
| No
| None
| The AWS Secret Key to authenticate with. This is not recommended; it is offered as a fallback authentication method only. Consult https://docs.aws.amazon.com/cli/v1/userguide/cli-chap-authentication.html[AWS documentation] for better options

| profile
| string
| No
| None
| The profile to use to authenticate against the AWS API. Consult https://docs.aws.amazon.com/sdkref/latest/guide/file-format.html#file-format-profile[AWS documentation for specifics]

| storageclass
| string
| No
| STANDARD
| The storage class to use for the object. You probably can leave this blank and use the bucket default. Consult https://aws.amazon.com/s3/storage-classes/[AWS documentation] for an overview of options. The following are currently valid: STANDARD REDUCED_REDUNDANCY STANDARD_IA ONEZONE_IA INTELLIGENT_TIERING GLACIER DEEP_ARCHIVE OUTPOSTS GLACIER_IR SNOW EXPRESS_ONEZONE

| endpoint
| string
| No
| AWS Auto
| Override the S3 API Endpoint we talk to. Useful if you're using S3 outside AWS or using a directory bucket
|===

Example:

[,yaml]
----
cache:
  name: s3
  bucket: my-cache--use1-az6--x-s3
  endpoint: "https://s3express-use1-az6.us-east-1.amazonaws.com"
  storageclass: EXPRESS_ONEZONE
  region: us-east-1
  profile: tilegroxy_s3_user
----